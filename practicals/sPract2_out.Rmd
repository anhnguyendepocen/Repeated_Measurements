## Practical 2: Mixed Effects Models for Continuous Data
We start by loading the packages we will need for this practical and the data from 
[GitHub](https://github.com/drizopoulos/Repeated_Measurements). This is achieved with the
following commands:
```{r}
# packages
library("lattice")
library("nlme")
library("splines")

# data
con <- url("https://raw.github.com/drizopoulos/Repeated_Measurements/master/Data.RData")
load(con)
close(con)
```
```{r, echo = FALSE}
options(warn = (-1))
```

### Question 1
We produce the plot of the subject-specific trajectories separately per treatment group with
a superimposed loess curve. This achieved with the following call to function 
[xyplot()](https://goo.gl/cGSjZk):
```{r}
length.no.NA <- function (x) sum(!is.na(x))
ns <- with(pbc2, tapply(prothrombin, id, length.no.NA))
ns <- names(ns)[ns >= 6]
```

```{r}
set.seed(123)
ids <- sample(ns, 16) 
xyplot(prothrombin ~ year | id,
       panel = function (x, y, ...) {
           panel.xyplot(x, y, type = "p", col = 1, ...)
           panel.loess(x, y, col = 2, lwd = 2, span = 0.8)
       }, data = pbc2, subset = id %in% ids, layout = c(4, 4), as.table = TRUE, 
       xlab = "Time (years)", ylab = "Prothrombin Time (sec)")
```

```{r}
set.seed(321)
ids <- sample(ns, 16) 
xyplot(prothrombin ~ year | id,
       panel = function (x, y, ...) {
           panel.xyplot(x, y, type = "p", col = 1, ...)
           panel.loess(x, y, col = 2, lwd = 2, span = 0.8)
       }, data = pbc2, subset = id %in% ids, layout = c(4, 4), as.table = TRUE, 
       xlab = "Time (years)", ylab = "Prothrombin Time (sec)")
```



### Question 2

### Question 3

```{r}
fm_1 <- lme(prothrombin ~ (year + I(year^2)) * (sex + drug) + ns(age, 3) + 
                ns(age, 3) : (sex + drug), data = pbc2, 
            random = ~ 1 | id, subset = prothrombin < 18)
```


### Question 4

```{r}
fm_2 <- update(fm_1, random = ~ year | id)
```

```{r}
anova(fm_1, fm_2)
```

```{r, cache = TRUE}
fm_3 <- update(fm_1, random = ~ year + I(year^2) | id)
```

```{r}
anova(fm_2, fm_3)
```

```{r, cache = TRUE}
fm_4 <- update(fm_1, random = ~ year + I(year^2) + I(year^3) | id)
```

```{r}
anova(fm_3, fm_4)
```

### Question 5

```{r, cache = TRUE}
fm_3ML <- update(fm_3, method = "ML")
fm_3ML_noInt <- update(fm_3ML, fixed = . ~ year + I(year^2) + sex + drug + ns(age, 3))
```

```{r}
anova(fm_3ML_noInt, fm_3ML)
```


### Question 6

```{r, cache = TRUE}
fm_3ML_noInt_AllLin <- update(fm_3ML, fixed = . ~ year + sex + drug + age)
```

```{r}
anova(fm_3ML_noInt_AllLin, fm_3ML_noInt)
```

```{r, cache = TRUE}
fm_3ML_noInt_LinTime <- update(fm_3ML, fixed = . ~ year + sex + drug + ns(age, 3))
```

```{r}
anova(fm_3ML_noInt_LinTime, fm_3ML_noInt)
```

```{r, cache = TRUE}
fm_3ML_noInt_LinAge <- update(fm_3ML, fixed = . ~ year + I(year^2) + sex + drug + age)
```

```{r}
anova(fm_3ML_noInt_LinAge, fm_3ML_noInt)
```

### Question 7




